<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.btjf.mapper.order.ProductionOrderMapper">
    <resultMap id="BaseResultMap" type="com.btjf.model.order.ProductionOrder">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <id column="id" jdbcType="INTEGER" property="id"/>
        <result column="productionNo" jdbcType="VARCHAR" property="productionNo"/>
        <result column="orderId" jdbcType="INTEGER" property="orderId"/>
        <result column="orderNo" jdbcType="VARCHAR" property="orderNo"/>
        <result column="productNo" jdbcType="VARCHAR" property="productNo"/>
        <result column="maxNum" jdbcType="INTEGER" property="maxNum"/>
        <result column="assignNum" jdbcType="INTEGER" property="assignNum"/>
        <result column="workshop" jdbcType="VARCHAR" property="workshop"/>
        <result column="workshopDirector" jdbcType="VARCHAR" property="workshopDirector"/>
        <result column="isLuo" jdbcType="INTEGER" property="isLuo"/>
        <result column="luoNum" jdbcType="INTEGER" property="luoNum"/>
        <result column="printer" jdbcType="VARCHAR" property="printer"/>
        <result column="printTime" jdbcType="DATE" property="printTime"/>
        <result column="printCount" jdbcType="INTEGER" property="printCount"/>
        <result column="codeUrl" jdbcType="VARCHAR" property="codeUrl"/>
        <result column="createTime" jdbcType="TIMESTAMP" property="createTime"/>
        <result column="lastModifyTime" jdbcType="TIMESTAMP" property="lastModifyTime"/>
        <result column="isDelete" jdbcType="INTEGER" property="isDelete"/>
        <result column="orderProductId" jdbcType="INTEGER" property="orderProductId"/>
        <result column="type" jdbcType="INTEGER" property="type"/>
    </resultMap>
    <sql id="Example_Where_Clause">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <where>
            <foreach collection="oredCriteria" item="criteria" separator="or">
                <if test="criteria.valid">
                    <trim prefix="(" prefixOverrides="and" suffix=")">
                        <foreach collection="criteria.criteria" item="criterion">
                            <choose>
                                <when test="criterion.noValue">
                                    and ${criterion.condition}
                                </when>
                                <when test="criterion.singleValue">
                                    and ${criterion.condition} #{criterion.value}
                                </when>
                                <when test="criterion.betweenValue">
                                    and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                                </when>
                                <when test="criterion.listValue">
                                    and ${criterion.condition}
                                    <foreach close=")" collection="criterion.value" item="listItem" open="("
                                             separator=",">
                                        #{listItem}
                                    </foreach>
                                </when>
                            </choose>
                        </foreach>
                    </trim>
                </if>
            </foreach>
        </where>
    </sql>
    <sql id="Update_By_Example_Where_Clause">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <where>
            <foreach collection="example.oredCriteria" item="criteria" separator="or">
                <if test="criteria.valid">
                    <trim prefix="(" prefixOverrides="and" suffix=")">
                        <foreach collection="criteria.criteria" item="criterion">
                            <choose>
                                <when test="criterion.noValue">
                                    and ${criterion.condition}
                                </when>
                                <when test="criterion.singleValue">
                                    and ${criterion.condition} #{criterion.value}
                                </when>
                                <when test="criterion.betweenValue">
                                    and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                                </when>
                                <when test="criterion.listValue">
                                    and ${criterion.condition}
                                    <foreach close=")" collection="criterion.value" item="listItem" open="("
                                             separator=",">
                                        #{listItem}
                                    </foreach>
                                </when>
                            </choose>
                        </foreach>
                    </trim>
                </if>
            </foreach>
        </where>
    </sql>
    <sql id="Base_Column_List">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        id, productionNo, orderId, orderNo, productNo, maxNum, assignNum, workshop, workshopDirector,
        isLuo, luoNum, printer, printTime, printCount, codeUrl, createTime, lastModifyTime,
        isDelete, orderProductId, type
    </sql>
    <select id="selectByExample" parameterType="com.btjf.model.order.ProductionOrderExample" resultMap="BaseResultMap">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        select
        <if test="distinct">
            distinct
        </if>
        <include refid="Base_Column_List"/>
        from t_Production_Order
        <if test="_parameter != null">
            <include refid="Example_Where_Clause"/>
        </if>
        <if test="orderByClause != null">
            order by ${orderByClause}
        </if>
    </select>
    <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        select
        <include refid="Base_Column_List"/>
        from t_Production_Order
        where id = #{id,jdbcType=INTEGER}
    </select>
    <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        delete from t_Production_Order
        where id = #{id,jdbcType=INTEGER}
    </delete>
    <delete id="deleteByExample" parameterType="com.btjf.model.order.ProductionOrderExample">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        delete from t_Production_Order
        <if test="_parameter != null">
            <include refid="Example_Where_Clause"/>
        </if>
    </delete>
    <insert id="insert" parameterType="com.btjf.model.order.ProductionOrder">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <selectKey keyProperty="id" order="AFTER" resultType="java.lang.Integer">
            SELECT LAST_INSERT_ID()
        </selectKey>
        insert into t_Production_Order (productionNo, orderId, orderNo,
        productNo, maxNum, assignNum,
        workshop, workshopDirector, isLuo,
        luoNum, printer, printTime,
        printCount, codeUrl, createTime,
        lastModifyTime, isDelete, orderProductId,
        type)
        values (#{productionNo,jdbcType=VARCHAR}, #{orderId,jdbcType=INTEGER}, #{orderNo,jdbcType=VARCHAR},
        #{productNo,jdbcType=VARCHAR}, #{maxNum,jdbcType=INTEGER}, #{assignNum,jdbcType=INTEGER},
        #{workshop,jdbcType=VARCHAR}, #{workshopDirector,jdbcType=VARCHAR}, #{isLuo,jdbcType=INTEGER},
        #{luoNum,jdbcType=INTEGER}, #{printer,jdbcType=VARCHAR}, #{printTime,jdbcType=DATE},
        #{printCount,jdbcType=INTEGER}, #{codeUrl,jdbcType=VARCHAR}, #{createTime,jdbcType=TIMESTAMP},
        #{lastModifyTime,jdbcType=TIMESTAMP}, #{isDelete,jdbcType=INTEGER}, #{orderProductId,jdbcType=INTEGER},
        #{type,jdbcType=INTEGER})
    </insert>
    <insert id="insertSelective" parameterType="com.btjf.model.order.ProductionOrder">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <selectKey keyProperty="id" order="AFTER" resultType="java.lang.Integer">
            SELECT LAST_INSERT_ID()
        </selectKey>
        insert into t_Production_Order
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="productionNo != null">
                productionNo,
            </if>
            <if test="orderId != null">
                orderId,
            </if>
            <if test="orderNo != null">
                orderNo,
            </if>
            <if test="productNo != null">
                productNo,
            </if>
            <if test="maxNum != null">
                maxNum,
            </if>
            <if test="assignNum != null">
                assignNum,
            </if>
            <if test="workshop != null">
                workshop,
            </if>
            <if test="workshopDirector != null">
                workshopDirector,
            </if>
            <if test="isLuo != null">
                isLuo,
            </if>
            <if test="luoNum != null">
                luoNum,
            </if>
            <if test="printer != null">
                printer,
            </if>
            <if test="printTime != null">
                printTime,
            </if>
            <if test="printCount != null">
                printCount,
            </if>
            <if test="codeUrl != null">
                codeUrl,
            </if>
            <if test="createTime != null">
                createTime,
            </if>
            <if test="lastModifyTime != null">
                lastModifyTime,
            </if>
            <if test="isDelete != null">
                isDelete,
            </if>
            <if test="orderProductId != null">
                orderProductId,
            </if>
            <if test="type != null">
                type,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="productionNo != null">
                #{productionNo,jdbcType=VARCHAR},
            </if>
            <if test="orderId != null">
                #{orderId,jdbcType=INTEGER},
            </if>
            <if test="orderNo != null">
                #{orderNo,jdbcType=VARCHAR},
            </if>
            <if test="productNo != null">
                #{productNo,jdbcType=VARCHAR},
            </if>
            <if test="maxNum != null">
                #{maxNum,jdbcType=INTEGER},
            </if>
            <if test="assignNum != null">
                #{assignNum,jdbcType=INTEGER},
            </if>
            <if test="workshop != null">
                #{workshop,jdbcType=VARCHAR},
            </if>
            <if test="workshopDirector != null">
                #{workshopDirector,jdbcType=VARCHAR},
            </if>
            <if test="isLuo != null">
                #{isLuo,jdbcType=INTEGER},
            </if>
            <if test="luoNum != null">
                #{luoNum,jdbcType=INTEGER},
            </if>
            <if test="printer != null">
                #{printer,jdbcType=VARCHAR},
            </if>
            <if test="printTime != null">
                #{printTime,jdbcType=DATE},
            </if>
            <if test="printCount != null">
                #{printCount,jdbcType=INTEGER},
            </if>
            <if test="codeUrl != null">
                #{codeUrl,jdbcType=VARCHAR},
            </if>
            <if test="createTime != null">
                #{createTime,jdbcType=TIMESTAMP},
            </if>
            <if test="lastModifyTime != null">
                #{lastModifyTime,jdbcType=TIMESTAMP},
            </if>
            <if test="isDelete != null">
                #{isDelete,jdbcType=INTEGER},
            </if>
            <if test="orderProductId != null">
                #{orderProductId,jdbcType=INTEGER},
            </if>
            <if test="type != null">
                #{type,jdbcType=INTEGER},
            </if>
        </trim>
    </insert>
    <select id="countByExample" parameterType="com.btjf.model.order.ProductionOrderExample" resultType="java.lang.Long">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        select count(*) from t_Production_Order
        <if test="_parameter != null">
            <include refid="Example_Where_Clause"/>
        </if>
    </select>
    <update id="updateByExampleSelective" parameterType="map">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update t_Production_Order
        <set>
            <if test="record.id != null">
                id = #{record.id,jdbcType=INTEGER},
            </if>
            <if test="record.productionNo != null">
                productionNo = #{record.productionNo,jdbcType=VARCHAR},
            </if>
            <if test="record.orderId != null">
                orderId = #{record.orderId,jdbcType=INTEGER},
            </if>
            <if test="record.orderNo != null">
                orderNo = #{record.orderNo,jdbcType=VARCHAR},
            </if>
            <if test="record.productNo != null">
                productNo = #{record.productNo,jdbcType=VARCHAR},
            </if>
            <if test="record.maxNum != null">
                maxNum = #{record.maxNum,jdbcType=INTEGER},
            </if>
            <if test="record.assignNum != null">
                assignNum = #{record.assignNum,jdbcType=INTEGER},
            </if>
            <if test="record.workshop != null">
                workshop = #{record.workshop,jdbcType=VARCHAR},
            </if>
            <if test="record.workshopDirector != null">
                workshopDirector = #{record.workshopDirector,jdbcType=VARCHAR},
            </if>
            <if test="record.isLuo != null">
                isLuo = #{record.isLuo,jdbcType=INTEGER},
            </if>
            <if test="record.luoNum != null">
                luoNum = #{record.luoNum,jdbcType=INTEGER},
            </if>
            <if test="record.printer != null">
                printer = #{record.printer,jdbcType=VARCHAR},
            </if>
            <if test="record.printTime != null">
                printTime = #{record.printTime,jdbcType=DATE},
            </if>
            <if test="record.printCount != null">
                printCount = #{record.printCount,jdbcType=INTEGER},
            </if>
            <if test="record.codeUrl != null">
                codeUrl = #{record.codeUrl,jdbcType=VARCHAR},
            </if>
            <if test="record.createTime != null">
                createTime = #{record.createTime,jdbcType=TIMESTAMP},
            </if>
            <if test="record.lastModifyTime != null">
                lastModifyTime = #{record.lastModifyTime,jdbcType=TIMESTAMP},
            </if>
            <if test="record.isDelete != null">
                isDelete = #{record.isDelete,jdbcType=INTEGER},
            </if>
            <if test="record.orderProductId != null">
                orderProductId = #{record.orderProductId,jdbcType=INTEGER},
            </if>
            <if test="record.type != null">
                type = #{record.type,jdbcType=INTEGER},
            </if>
        </set>
        <if test="_parameter != null">
            <include refid="Update_By_Example_Where_Clause"/>
        </if>
    </update>
    <update id="updateByExample" parameterType="map">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update t_Production_Order
        set id = #{record.id,jdbcType=INTEGER},
        productionNo = #{record.productionNo,jdbcType=VARCHAR},
        orderId = #{record.orderId,jdbcType=INTEGER},
        orderNo = #{record.orderNo,jdbcType=VARCHAR},
        productNo = #{record.productNo,jdbcType=VARCHAR},
        maxNum = #{record.maxNum,jdbcType=INTEGER},
        assignNum = #{record.assignNum,jdbcType=INTEGER},
        workshop = #{record.workshop,jdbcType=VARCHAR},
        workshopDirector = #{record.workshopDirector,jdbcType=VARCHAR},
        isLuo = #{record.isLuo,jdbcType=INTEGER},
        luoNum = #{record.luoNum,jdbcType=INTEGER},
        printer = #{record.printer,jdbcType=VARCHAR},
        printTime = #{record.printTime,jdbcType=DATE},
        printCount = #{record.printCount,jdbcType=INTEGER},
        codeUrl = #{record.codeUrl,jdbcType=VARCHAR},
        createTime = #{record.createTime,jdbcType=TIMESTAMP},
        lastModifyTime = #{record.lastModifyTime,jdbcType=TIMESTAMP},
        isDelete = #{record.isDelete,jdbcType=INTEGER},
        orderProductId = #{record.orderProductId,jdbcType=INTEGER},
        type = #{record.type,jdbcType=INTEGER}
        <if test="_parameter != null">
            <include refid="Update_By_Example_Where_Clause"/>
        </if>
    </update>
    <update id="updateByPrimaryKeySelective" parameterType="com.btjf.model.order.ProductionOrder">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update t_Production_Order
        <set>
            <if test="productionNo != null">
                productionNo = #{productionNo,jdbcType=VARCHAR},
            </if>
            <if test="orderId != null">
                orderId = #{orderId,jdbcType=INTEGER},
            </if>
            <if test="orderNo != null">
                orderNo = #{orderNo,jdbcType=VARCHAR},
            </if>
            <if test="productNo != null">
                productNo = #{productNo,jdbcType=VARCHAR},
            </if>
            <if test="maxNum != null">
                maxNum = #{maxNum,jdbcType=INTEGER},
            </if>
            <if test="assignNum != null">
                assignNum = #{assignNum,jdbcType=INTEGER},
            </if>
            <if test="workshop != null">
                workshop = #{workshop,jdbcType=VARCHAR},
            </if>
            <if test="workshopDirector != null">
                workshopDirector = #{workshopDirector,jdbcType=VARCHAR},
            </if>
            <if test="isLuo != null">
                isLuo = #{isLuo,jdbcType=INTEGER},
            </if>
            <if test="luoNum != null">
                luoNum = #{luoNum,jdbcType=INTEGER},
            </if>
            <if test="printer != null">
                printer = #{printer,jdbcType=VARCHAR},
            </if>
            <if test="printTime != null">
                printTime = #{printTime,jdbcType=DATE},
            </if>
            <if test="printCount != null">
                printCount = #{printCount,jdbcType=INTEGER},
            </if>
            <if test="codeUrl != null">
                codeUrl = #{codeUrl,jdbcType=VARCHAR},
            </if>
            <if test="createTime != null">
                createTime = #{createTime,jdbcType=TIMESTAMP},
            </if>
            <if test="lastModifyTime != null">
                lastModifyTime = #{lastModifyTime,jdbcType=TIMESTAMP},
            </if>
            <if test="isDelete != null">
                isDelete = #{isDelete,jdbcType=INTEGER},
            </if>
            <if test="orderProductId != null">
                orderProductId = #{orderProductId,jdbcType=INTEGER},
            </if>
            <if test="type != null">
                type = #{type,jdbcType=INTEGER},
            </if>
        </set>
        where id = #{id,jdbcType=INTEGER}
    </update>
    <update id="updateByPrimaryKey" parameterType="com.btjf.model.order.ProductionOrder">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update t_Production_Order
        set productionNo = #{productionNo,jdbcType=VARCHAR},
        orderId = #{orderId,jdbcType=INTEGER},
        orderNo = #{orderNo,jdbcType=VARCHAR},
        productNo = #{productNo,jdbcType=VARCHAR},
        maxNum = #{maxNum,jdbcType=INTEGER},
        assignNum = #{assignNum,jdbcType=INTEGER},
        workshop = #{workshop,jdbcType=VARCHAR},
        workshopDirector = #{workshopDirector,jdbcType=VARCHAR},
        isLuo = #{isLuo,jdbcType=INTEGER},
        luoNum = #{luoNum,jdbcType=INTEGER},
        printer = #{printer,jdbcType=VARCHAR},
        printTime = #{printTime,jdbcType=DATE},
        printCount = #{printCount,jdbcType=INTEGER},
        codeUrl = #{codeUrl,jdbcType=VARCHAR},
        createTime = #{createTime,jdbcType=TIMESTAMP},
        lastModifyTime = #{lastModifyTime,jdbcType=TIMESTAMP},
        isDelete = #{isDelete,jdbcType=INTEGER},
        orderProductId = #{orderProductId,jdbcType=INTEGER},
        type = #{type,jdbcType=INTEGER}
        where id = #{id,jdbcType=INTEGER}
    </update>

    <select id="getByOrderProductID" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from t_Production_Order
        WHERE orderProductId = #{orderProductID} and isDelete = 0 limit 1;
    </select>

    <select id="findList" parameterType="com.btjf.controller.productionorder.vo.ProductionOrderVo"
            resultType="com.btjf.controller.productionorder.vo.ProductionOrderVo">

        SELECT
        *, DATE_FORMAT(createTimes,'%Y-%m-%d') as createTime
        FROM
        (
        SELECT
        tpo.orderNo AS orderNo,
        tpo.productionNo AS productionNo,
        top.customerName AS customerName,
        tpo.productNo AS productNo,
        top.productType AS productType,
        tpo.workshop AS workshop,
        tpo.workshopDirector AS workshopDirector,
        tpo.createTime
        AS createTimes,
        tpo.assignNum AS assignNum,
        top.unit AS unit,
        tpo.maxNum AS maxNum,
        tpo.type as type
        FROM
        t_Production_Order tpo
        LEFT JOIN t_Order_Product top ON tpo.orderProductId = top.id
        where
        1=1
        <if test="orderNo != null">
            AND tpo.orderNo LIKE '%${orderNo}%'
        </if>
        <if test="productionNo != null">
            AND tpo.productionNo LIKE '%${productionNo}%'
        </if>
        <if test="customerName != null">
            AND top.customerName LIKE '%${customerName}%'
        </if>
        <if test="productNo != null">
            AND tpo.productNo LIKE '%${productNo}%'
        </if>
        <if test="productType != null">
            AND top.productType LIKE '%${productType}%'
        </if>
        <if test="workshop != null">
            AND tpo.workshop LIKE '%${workshop}%'
        </if>
        <if test="workshopDirector != null">
            AND tpo.workshopDirector LIKE '%${workshopDirector}%'
        </if>
        <if test="createEndTime != null">
            AND tpo.createTime &lt;= #{createEndTime,jdbcType=VARCHAR)
        </if>
        <if test="createStartTime != null">
            and tpo.createStartTime &gt;= #{createStartTime,jdbcType=VARCHAR)
        </if>
        AND tpo.isDelete = 0
        AND top.isDelete = 0
        AND tpo.type = 1

        UNION ALL

        SELECT
        tmp.orderNo AS orderNo,
        tpo.productionNo AS productionNo,
        top.customerName AS customerName,
        tmp.productNo AS productNo,
        top.productType AS productType,
        tpo.workshop AS workshop,
        tpo.workshopDirector AS workshopDirector,
        tpo.createTime AS createTimes,
        tmp.fristNum AS sassignNum,
        top.unit AS unit,
        tpo.maxNum AS maxNum,
        tpo.type as type
        FROM
        t_Production_Order tpo
        LEFT JOIN t_Order_Product top ON tpo.orderProductId = top.id
        LEFT JOIN t_Multiple_Production tmp ON tpo.id = tmp.productionId
        WHERE
        1=1
        <if test="orderNo != null">
            AND tmp.orderNo LIKE '%${orderNo}%'
        </if>
        <if test="productionNo != null">
            AND tpo.productionNo LIKE '%${productionNo}%'
        </if>
        <if test="customerName != null">
            AND top.customerName LIKE '%${customerName}%'
        </if>
        <if test="productNo != null">
            AND tpo.productNo LIKE '%${productNo}%'
        </if>
        <if test="productType != null">
            AND top.productType LIKE '%${productType}%'
        </if>
        <if test="workshop != null">
            AND tpo.workshop LIKE '%${workshop}%'
        </if>
        <if test="workshopDirector != null">
            AND tpo.workshopDirector LIKE '%${workshopDirector}%'
        </if>
        <if test="createEndTime != null">
            AND tpo.createTime &lt;= #{createEndTime,jdbcType=VARCHAR)
        </if>
        <if test="createStartTime != null">
            and tpo.createStartTime &gt;= #{createStartTime,jdbcType=VARCHAR)
        </if>
        AND tpo.isDelete = 0
        AND top.isDelete = 0
        AND tpo.type = 2
        AND tmp.isDelete = 0
        ) a
        ORDER BY
        a.createTimes desc


    </select>


    <select id="getByNo" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM t_Production_Order
        WHERE productionNo =#{productionNo} and isDelete = 0
    </select>

</mapper>